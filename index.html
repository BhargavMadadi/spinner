<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AKD · Bhangra Show Order</title>
<link href="https://fonts.googleapis.com/css2?family=Bangers&family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
  :root {
    --space-1: #060216;
    --ink:     #f9f8ff;
    --muted:   #c7c6ff;
    --accent:  #72ff9b;
    --accent-2:#7b3cff;
    --border:  rgba(255,255,255,0.14);
    --panel:   linear-gradient(145deg,rgba(12,5,46,.95),rgba(19,10,56,.97));
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    font-family: "Inter", system-ui, sans-serif;
    color: var(--ink);
    min-height: 100vh;
    overflow-x: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2.4rem 1.2rem 3.6rem;
    position: relative;
  }

  /* Background — fixed base */
  .bg {
    position: fixed; inset: 0; z-index: -1;
    background: var(--space-1);
    overflow: hidden;
  }
  /* top-right blob — failsafe nudges opacity ever so slightly */
  .bg-tr {
    position: absolute;
    width: 1200px; height: 800px;
    top: -10%; left: 80%;
    background: radial-gradient(ellipse, #2a1466 0%, transparent 60%);
    opacity: 0.7;
    transform-origin: top right;
    transition: opacity 2s ease, transform 2s ease;
  }
  /* bottom-left blob — static */
  .bg-bl {
    position: absolute;
    width: 1000px; height: 700px;
    bottom: -10%; left: 10%;
    background: radial-gradient(ellipse, #3a0ca3 0%, transparent 60%);
    opacity: 0.7;
  }

  /* ── TITLES ── */
  .page-title {
    font-family: "Bangers";
    font-size: clamp(2.6rem, 6vw, 4rem);
    letter-spacing: .16em;
    text-transform: uppercase;
    text-align: center;
    margin-bottom: .3rem;
  }
  .event-tag {
    text-align: center;
    color: var(--muted);
    font-size: .8rem;
    letter-spacing: .18em;
    text-transform: uppercase;
    font-weight: 700;
    margin-bottom: .8rem;
  }


  /* ── LAYOUT ── */
  .layout {
    display: flex;
    gap: 1.6rem;
    width: 100%;
    max-width: 1060px;
    align-items: flex-start;
    justify-content: center;
  }

  .wheel-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.1rem;
    min-width: 0;
  }

  .wheel-wrap {
    position: relative;
    width: min(520px, 90vw);
    height: min(520px, 90vw);
  }

  canvas#wheelCanvas {
    width: 100%; height: 100%;
    cursor: pointer;
    filter: drop-shadow(0 0 32px rgba(123,60,255,.38));
    transition: filter .3s, opacity .4s;
    display: block;
  }
  canvas#wheelCanvas:hover {
    filter: drop-shadow(0 0 48px rgba(123,60,255,.58));
  }

  .pointer {
    position: absolute;
    right: -3px; top: 50%;
    transform: translateY(-50%);
    width: 0; height: 0;
    border-top: 15px solid transparent;
    border-bottom: 15px solid transparent;
    border-right: 32px solid var(--accent);
    filter: drop-shadow(0 0 6px rgba(114,255,155,.7));
    z-index: 10;
    transition: opacity .4s;
  }

  .hub {
    position: absolute; top: 50%; left: 50%;
    transform: translate(-50%,-50%);
    width: 52px; height: 52px; border-radius: 50%;
    background: radial-gradient(circle at top left, rgba(255,255,255,.12), rgba(6,2,22,.96));
    border: 2px solid rgba(255,255,255,.22);
    box-shadow: 0 18px 35px rgba(0,0,0,.55);
    z-index: 10;
    display: flex; align-items: center; justify-content: center;
    font-family: "Bangers"; font-size: 11px; letter-spacing: 1px;
    color: var(--ink); cursor: pointer;
    transition: border-color .2s, box-shadow .2s, opacity .4s;
  }
  .hub:hover {
    border-color: rgba(114,255,155,.4);
    box-shadow: 0 0 22px rgba(114,255,155,.25);
  }

  /* ── FINAL OVERLAY ── */
  .final-overlay {
    position: absolute;
    inset: 0;
    border-radius: 1.1rem;
    background: var(--panel);
    border: 1px solid var(--border);
    box-shadow: 0 18px 40px rgba(0,0,0,.8);
    display: flex;
    flex-direction: column;
    padding: 1.4rem 1.5rem;
    gap: .5rem;
    opacity: 0;
    pointer-events: none;
    transition: opacity .5s ease;
    z-index: 20;
    overflow-y: auto;
  }
  .final-overlay.show {
    opacity: 1;
    pointer-events: auto;
  }
  .final-overlay-header {
    font-family: "Bangers";
    font-size: 1rem;
    letter-spacing: .18em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: .3rem;
    flex-shrink: 0;
  }
  .fo-row {
    display: flex; align-items: center; gap: .75rem;
    background: radial-gradient(circle at top left, rgba(255,255,255,.08), rgba(6,2,22,.96));
    border: 1px solid var(--border);
    border-radius: .9rem;
    padding: .7rem 1rem;
    box-shadow: 0 8px 20px rgba(0,0,0,.45);
    flex-shrink: 0;
    opacity: 0;
    transform: translateY(10px);
    transition: opacity .35s ease, transform .35s ease;
  }
  .fo-row.visible { opacity: 1; transform: translateY(0); }
  .fo-num {
    font-family: "Bangers"; font-size: 1.6rem; letter-spacing: .06em;
    color: var(--accent); min-width: 24px;
  }
  .fo-name { font-weight: 800; font-size: .9rem; }

  .wheel-wrap.done canvas,
  .wheel-wrap.done .pointer,
  .wheel-wrap.done .hub { opacity: 0; pointer-events: none; }

  /* ── BUTTONS ── */
  .spin-btn {
    display: inline-flex;
    align-items: center; justify-content: center;
    padding: .8rem 2.4rem;
    border-radius: 999px;
    font-family: "Inter"; font-weight: 800; font-size: 1rem;
    border: 1px solid transparent;
    cursor: pointer;
    transition: .12s ease-out;
    background: linear-gradient(135deg, #72ff9b, #7b3cff);
    color: #060215;
    box-shadow: 0 10px 26px rgba(114,255,155,.35), 0 0 60px rgba(123,60,255,.2) inset;
    letter-spacing: .04em;
  }
  .spin-btn:hover { opacity:.9; transform:translateY(-1px); }
  .spin-btn:active { transform:translateY(0); }
  .spin-btn:disabled { opacity:.35; cursor:not-allowed; transform:none; }
  .spin-btn.hidden { display: none; }

  /* ghost-style reset button */
  .reset-btn {
    display: inline-flex;
    align-items: center; justify-content: center;
    padding: .65rem 2rem;
    border-radius: 999px;
    font-family: "Inter"; font-weight: 800; font-size: .9rem;
    border: 1px solid rgba(255,255,255,.35);
    cursor: pointer;
    background: transparent;
    color: var(--ink);
    letter-spacing: .04em;
    transition: .12s ease-out;
  }
  .reset-btn:hover { background: rgba(255,255,255,.08); }
  .reset-btn.hidden { display: none; }

  /* ── RESULT BANNER ── */
  .result-banner {
    display: none;
    align-items: center; gap: .9rem;
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 1.1rem;
    padding: 1rem 1.5rem;
    box-shadow: 0 18px 40px rgba(0,0,0,.6);
    width: 100%; max-width: 520px;
    animation: slideIn .35s ease;
  }
  .result-banner.show { display: flex; }
  .result-banner.hidden { display: none !important; }
  .rb-num {
    font-family: "Bangers"; font-size: 2.2rem; letter-spacing: .08em;
    color: var(--accent); min-width: 30px;
  }
  .rb-name { font-weight: 900; font-size: 1rem; flex: 1; }

  @keyframes slideIn {
    from { opacity:0; transform:translateY(8px); }
    to   { opacity:1; transform:translateY(0); }
  }

  /* ── SIDEBAR ── */
  .sidebar {
    width: 256px; flex-shrink: 0;
    display: flex; flex-direction: column; gap: .9rem;
    padding-top: .2rem;
  }
  .s-card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 1.1rem;
    padding: 1.2rem 1.2rem 1.3rem;
    box-shadow: 0 18px 40px rgba(0,0,0,.6);
  }
  .s-card h3 {
    font-family: "Bangers"; font-size: .92rem; letter-spacing: .16em;
    text-transform: uppercase; color: var(--muted);
    margin-bottom: .75rem;
  }

  .team-list { display: flex; flex-direction: column; gap: .42rem; }
  .team-item {
    display: flex; align-items: center; gap: .6rem;
    padding: .6rem .85rem;
    border-radius: .9rem;
    border: 1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.05);
    font-size: .83rem; font-weight: 700;
    transition: opacity .2s;
  }
  .team-item.done { opacity: .28; text-decoration: line-through; }
  .team-dot {
    width: 7px; height: 7px; border-radius: 50%;
    flex-shrink: 0; background: var(--accent-2);
    transition: background .2s;
  }
  .team-item.done .team-dot { background: rgba(255,255,255,.2); }
  .team-name-text { flex: 1; }

  .counter {
    text-align: center; font-size: .8rem; font-weight: 700;
    color: var(--muted); letter-spacing: .06em;
  }
  .counter span { color: var(--accent); }

  /* sparkles */
  .sparkle {
    position: fixed; pointer-events: none; z-index: 9998;
    animation: sparkleFall 1.3s ease-out forwards; font-size: 15px;
  }
  @keyframes sparkleFall {
    0%   { transform: translateY(0) rotate(0deg); opacity: 1; }
    100% { transform: translateY(240px) rotate(400deg); opacity: 0; }
  }

  @media(max-width: 720px) {
    .layout { flex-direction: column; align-items: center; }
    .sidebar { width: 100%; max-width: 520px; }
  }
</style>
</head>
<body>

<div class="bg">
  <div class="bg-tr" id="bgTr"></div>
  <div class="bg-bl"></div>
</div>

<h1 class="page-title">Bhangra Show Order</h1>
<p class="event-tag">AAJ KA DHAMAKA · March 7, 2026</p>


<div class="layout">

  <div class="wheel-section">
    <div class="wheel-wrap" id="wheelWrap">
      <canvas id="wheelCanvas" width="600" height="600"></canvas>
      <div class="pointer"></div>
      <div class="hub" onclick="doSpin()">SPIN</div>
      <div class="final-overlay" id="finalOverlay">
        <div class="final-overlay-header">✦ &nbsp;Full Show Order</div>
      </div>
    </div>

    <button class="spin-btn" id="spinBtn" onclick="doSpin()">Spin the Wheel</button>
    <button class="reset-btn hidden" id="resetBtn" onclick="nextRound()">↩ &nbsp;Go Again</button>

    <div class="result-banner" id="resultBanner">
      <div class="rb-num" id="rbNum"></div>
      <div class="rb-name" id="rbName"></div>
    </div>
  </div>

  <div class="sidebar">
    <div class="s-card">
      <h3>Teams</h3>
      <div class="team-list" id="teamList"></div>
    </div>
    <div class="s-card">
      <div class="counter">
        Pick <span id="picksDone">0</span> of <span id="picksTotal">5</span> this round
      </div>
    </div>
  </div>

</div>

<script>
// ═══════════════════════════════════════════════
//  CONFIG
// ═══════════════════════════════════════════════
const LOCKED_LAST = "Lok Naach";
const ALL_TEAMS = [
  "Stanford Bhangra",
  "Classic City Bhangra",
  "Mehfil Mitraan Di Bhangra",
  "Lok Naach",
  "Birmingham's Blazin' Bhangra",
];
const SLICE_COLORS = [
  "#1e0d5e","#14073b","#2a1466","#0b0624",
  "#1a0a4a","#0f0535","#231060","#100530",
];

// ═══════════════════════════════════════════════
//  STATE
// ═══════════════════════════════════════════════
let currentRound    = 1;
let roundOrder      = [];  // full 5-pick rigged sequence for this round
let pickedThisRound = [];
let spinning        = false;
let angle           = 0;

function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

// Build rigged order for current round
// Rounds 1 & 2: truly random
// Round 3: Lok Naach guaranteed last
function buildRoundOrder() {
  const others = ALL_TEAMS.filter(t => t !== LOCKED_LAST);
  const rand   = shuffle(others);
  roundOrder   = currentRound === 3 ? [...rand, LOCKED_LAST] : shuffle([...ALL_TEAMS]);
}

function initRound() {
  buildRoundOrder();
  pickedThisRound = [];
  angle = 0;

  // reset overlay
  const overlay = document.getElementById('finalOverlay');
  overlay.classList.remove('show');
  while (overlay.children.length > 1) overlay.removeChild(overlay.lastChild);
  document.getElementById('wheelWrap').classList.remove('done');

  document.getElementById('resultBanner').classList.remove('show', 'hidden');

  document.getElementById('spinBtn').classList.remove('hidden');
  document.getElementById('spinBtn').disabled = false;
  document.getElementById('spinBtn').textContent = 'Spin the Wheel';
  document.getElementById('resetBtn').classList.add('hidden');

  updateCounter();
  renderTeamList();
  drawWheel();
}

// ═══════════════════════════════════════════════
//  CANVAS
// ═══════════════════════════════════════════════
const canvas = document.getElementById('wheelCanvas');
const ctx    = canvas.getContext('2d');
const CX = canvas.width  / 2;
const CY = canvas.height / 2;
const R  = canvas.width  / 2 - 14;

function lighten(hex, amt) {
  const n = parseInt(hex.slice(1), 16);
  const r = Math.min(255, (n >> 16) + Math.round(amt * 255));
  const g = Math.min(255, ((n >> 8) & 0xff) + Math.round(amt * 255));
  const b = Math.min(255, (n & 0xff) + Math.round(amt * 255));
  return `rgb(${r},${g},${b})`;
}

function drawWheel(highlightName = null) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  const remaining = ALL_TEAMS.filter(t => !pickedThisRound.includes(t));
  const n = remaining.length;
  if (n === 0) return;

  const slice = (2 * Math.PI) / n;

  ctx.beginPath();
  ctx.arc(CX, CY, R + 8, 0, 2 * Math.PI);
  ctx.strokeStyle = 'rgba(123,60,255,0.5)';
  ctx.lineWidth = 3;
  ctx.stroke();

  ctx.beginPath();
  ctx.arc(CX, CY, R + 2, 0, 2 * Math.PI);
  ctx.strokeStyle = 'rgba(255,255,255,0.07)';
  ctx.lineWidth = 1;
  ctx.stroke();

  for (let i = 0; i < n; i++) {
    const start = angle + i * slice;
    const end   = start + slice;
    const isHL  = (remaining[i] === highlightName);

    ctx.beginPath();
    ctx.moveTo(CX, CY);
    ctx.arc(CX, CY, R, start, end);
    ctx.closePath();

    if (isHL) {
      ctx.fillStyle = '#7b3cff';
    } else {
      const gx   = CX + Math.cos(start + slice / 2) * R * 0.5;
      const gy   = CY + Math.sin(start + slice / 2) * R * 0.5;
      const grad = ctx.createRadialGradient(CX, CY, 0, gx, gy, R * 0.85);
      grad.addColorStop(0, lighten(SLICE_COLORS[i % SLICE_COLORS.length], 0.14));
      grad.addColorStop(1, SLICE_COLORS[i % SLICE_COLORS.length]);
      ctx.fillStyle = grad;
    }
    ctx.fill();

    ctx.strokeStyle = 'rgba(255,255,255,0.09)';
    ctx.lineWidth = 1.5;
    ctx.stroke();

    ctx.save();
    ctx.translate(CX, CY);
    ctx.rotate(start + slice / 2);
    ctx.textAlign = 'right';
    const fs = Math.max(11, Math.min(17, Math.floor(R * 0.115)));
    ctx.font = `800 ${fs}px Inter, sans-serif`;
    ctx.fillStyle = 'rgba(249,248,255,0.93)';
    ctx.shadowColor = 'rgba(0,0,0,0.95)';
    ctx.shadowBlur  = 5;

    let label = remaining[i];
    const maxW = R * 0.68;
    while (ctx.measureText(label).width > maxW && label.length > 2)
      label = label.slice(0, -1);
    if (label !== remaining[i]) label += '…';

    ctx.fillText(label, R - 18, fs / 3);
    ctx.restore();
  }
}

// ═══════════════════════════════════════════════
//  SPIN
// ═══════════════════════════════════════════════
function doSpin() {
  if (spinning) return;

  const remaining = ALL_TEAMS.filter(t => !pickedThisRound.includes(t));
  if (remaining.length === 0) return;

  // Auto-resolve last pick
  if (remaining.length === 1) {
    onPickComplete(remaining[0]);
    return;
  }

  spinning = true;
  document.getElementById('spinBtn').disabled = true;
  document.getElementById('resultBanner').classList.remove('show');

  const target    = roundOrder[pickedThisRound.length];
  const targetIdx = remaining.indexOf(target);
  const n         = remaining.length;
  const slice     = (2 * Math.PI) / n;

  const targetAngle = -(targetIdx * slice + slice / 2);
  let needed = ((targetAngle - angle) % (2 * Math.PI) + 2 * Math.PI) % (2 * Math.PI);

  const extraSpins = (5 + Math.floor(Math.random() * 4)) * 2 * Math.PI;
  const total      = extraSpins + needed;
  const startAngle = angle;
  const duration   = 3500 + Math.random() * 900;
  const t0         = performance.now();

  function ease(t) { return 1 - Math.pow(1 - t, 4); }

  (function tick(now) {
    const t = Math.min((now - t0) / duration, 1);
    angle   = startAngle + total * ease(t);
    drawWheel();
    if (t < 1) {
      requestAnimationFrame(tick);
    } else {
      angle = (startAngle + total) % (2 * Math.PI);
      drawWheel(target);
      setTimeout(() => onPickComplete(target), 350);
    }
  })(t0);
}

// ═══════════════════════════════════════════════
//  AFTER EACH PICK
// ═══════════════════════════════════════════════
function onPickComplete(team) {
  spinning = false;
  pickedThisRound.push(team);

  const pickNum     = pickedThisRound.length;
  const isRoundDone = pickNum === ALL_TEAMS.length;

  document.getElementById('rbNum').textContent  = pickNum;
  document.getElementById('rbName').textContent = team;
  document.getElementById('resultBanner').classList.add('show');

  updateCounter();
  renderTeamList();
  spawnSparkles();

  setTimeout(() => {
    drawWheel();
    const btn      = document.getElementById('spinBtn');
    const remaining = ALL_TEAMS.filter(t => !pickedThisRound.includes(t));

    if (isRoundDone) {
      btn.classList.add('hidden');
      document.getElementById('resultBanner').classList.add('hidden');
      showFinalOverlay();
    } else {
      btn.disabled = false;
      // When only 1 team left on ANY round, label the button clearly
      btn.textContent = (remaining.length === 1)
        ? 'Show Full Show Order'
        : 'Spin the Wheel';
    }
  }, 500);
}

// ═══════════════════════════════════════════════
//  FINAL OVERLAY
// ═══════════════════════════════════════════════
function showFinalOverlay() {
  const wrap    = document.getElementById('wheelWrap');
  const overlay = document.getElementById('finalOverlay');

  wrap.classList.add('done');

  while (overlay.children.length > 1) overlay.removeChild(overlay.lastChild);

  pickedThisRound.forEach((team, i) => {
    const row = document.createElement('div');
    row.className = 'fo-row';
    row.innerHTML = `<div class="fo-num">${i + 1}</div><div class="fo-name">${team}</div>`;
    overlay.appendChild(row);
  });

  setTimeout(() => {
    overlay.classList.add('show');
    const rows = overlay.querySelectorAll('.fo-row');
    rows.forEach((r, i) => {
      setTimeout(() => r.classList.add('visible'), 200 + i * 140);
    });
    spawnSparkles();

    // Always show "Go Again" below the overlay
    const resetBtn = document.getElementById('resetBtn');
    resetBtn.textContent = '↩  Go Again';
    setTimeout(() => resetBtn.classList.remove('hidden'), 200 + ALL_TEAMS.length * 140 + 300);
  }, 450);
}

// ═══════════════════════════════════════════════
//  NEXT ROUND
// ═══════════════════════════════════════════════
function nextRound() {
  currentRound++;
  // Round 3 was the rigged one — round 4+ is fully random, looks totally normal
  initRound();
}

// ═══════════════════════════════════════════════
//  SIDEBAR
// ═══════════════════════════════════════════════
function renderTeamList() {
  const el = document.getElementById('teamList');
  el.innerHTML = '';
  ALL_TEAMS.forEach(t => {
    const done = pickedThisRound.includes(t);
    const item = document.createElement('div');
    item.className = 'team-item' + (done ? ' done' : '');
    item.innerHTML = `<div class="team-dot"></div><span class="team-name-text">${t}</span>`;
    el.appendChild(item);
  });
}

function updateCounter() {
  document.getElementById('picksDone').textContent = pickedThisRound.length;
  document.getElementById('picksTotal').textContent = ALL_TEAMS.length;
}

// ═══════════════════════════════════════════════
//  FAILSAFE — Shift+L
//  Re-rigs round order silently.
//  Visual: top-right bg blob dims very slightly
//  for 2s then returns — barely perceptible.
// ═══════════════════════════════════════════════
let failsafeTimeout = null;
document.addEventListener('keydown', (e) => {
  if (e.shiftKey && (e.key === 'L' || e.key === 'l')) {
    buildRoundOrder();

    const blob = document.getElementById('bgTr');
    // Barely perceptible swell — looks like natural ambient breathing
    blob.style.transition = 'opacity 2s ease, transform 2s ease';
    blob.style.opacity = '0.88';
    blob.style.transform = 'scale(1.05)';
    if (failsafeTimeout) clearTimeout(failsafeTimeout);
    failsafeTimeout = setTimeout(() => {
      blob.style.transition = 'opacity 3.5s ease, transform 3.5s ease';
      blob.style.opacity = '0.7';
      blob.style.transform = 'scale(1)';
    }, 2500);
  }
});

// ═══════════════════════════════════════════════
//  SPARKLES
// ═══════════════════════════════════════════════
function spawnSparkles() {
  const e = ['✦','★','✧','◆','✨'];
  for (let i = 0; i < 16; i++) {
    setTimeout(() => {
      const s = document.createElement('div');
      s.className   = 'sparkle';
      s.textContent = e[Math.floor(Math.random() * e.length)];
      s.style.left  = Math.random() * 100 + 'vw';
      s.style.top   = Math.random() * 80 + 'px';
      document.body.appendChild(s);
      setTimeout(() => s.remove(), 1400);
    }, i * 60);
  }
}

// ── INIT ──
initRound();
canvas.addEventListener('click', doSpin);
</script>
</body>
</html>
